<template>
  <!-- Floating Prototype Switcher -->
  <div class="floating-prototype-switcher">
    <div class={prototype1TabClass} onclick={handlePrototype1Click}>
      <span class="prototype-label">Prototype 1</span>
    </div>
    <div class={prototype2TabClass} onclick={handlePrototype2Click}>
      <span class="prototype-label">Prototype 2</span>
    </div>
    <div class={prototype3TabClass} onclick={handlePrototype3Click}>
      <span class="prototype-label">Prototype 3</span>
    </div>
  </div>

  <div class="app-container prototype-2">
    <!-- Header Section -->
    <div class="slds-builder-header_container">
      <!-- Builder Header -->
      <header class="slds-builder-header">
        <!-- Back Button -->
        <div class="slds-builder-header__item">
          <div class="slds-builder-header__item-action">
            <lightning-button-icon 
              icon-name="utility:back" 
              variant="border-inverse" 
              size="small"
              alternative-text="Back">
            </lightning-button-icon>
          </div>
        </div>
        
        <!-- Lightning App Builder -->
        <div class="slds-builder-header__item">
          <div class="slds-builder-header__item-action">
            <div class="slds-media">
              <div class="slds-media__figure">
                <lightning-icon icon-name="utility:builder" size="x-small" variant="inverse"></lightning-icon>
              </div>
              <div class="slds-media__body">
                <span class="slds-truncate">Lightning App Builder</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Pages Dropdown -->
        <div class="slds-builder-header__item">
          <div class="slds-builder-header__item-action">
            <div class="slds-media">
              <div class="slds-media__figure">
                <lightning-icon icon-name="utility:page" size="x-small" variant="inverse"></lightning-icon>
              </div>
              <div class="slds-media__body">
                <span class="slds-truncate">Pages</span>
              </div>
              <div class="slds-media__figure slds-media__figure_reverse">
                <lightning-icon icon-name="utility:chevron_down" size="xx-small" variant="inverse"></lightning-icon>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Main Title (Flexible) - MODIFIED FOR PROTOTYPE 2 -->
        <div class="slds-builder-header__item slds-builder-header__item_main">
          <div class="slds-builder-header__item-label">
            <span class="slds-truncate">Unified Profile for Contact</span>
          </div>
        </div>
        
        
        <!-- Help -->
        <div class="slds-builder-header__item">
          <div class="slds-builder-header__item-action">
            <div class="slds-media">
              <div class="slds-media__figure">
                <lightning-icon icon-name="utility:help" size="x-small" variant="inverse"></lightning-icon>
              </div>
              <div class="slds-media__body">
                <span class="slds-truncate">Help</span>
              </div>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Builder Toolbar -->
      <div class="slds-builder-toolbar">
        <!-- Left Button Groups -->
        <div class="slds-builder-toolbar__item-group">
          <lightning-button-group>
            <lightning-button-icon 
              icon-name="utility:undo" 
              variant="border" 
              size="small"
              alternative-text="Undo">
            </lightning-button-icon>
            <lightning-button-icon 
              icon-name="utility:redo" 
              variant="border" 
              size="small"
              alternative-text="Redo">
            </lightning-button-icon>
          </lightning-button-group>
        </div>
        
        <div class="slds-builder-toolbar__item-group">
          <lightning-button-group>
            <lightning-button-icon 
              icon-name="utility:cut" 
              variant="border" 
              size="small"
              alternative-text="Cut">
            </lightning-button-icon>
            <lightning-button-icon 
              icon-name="utility:copy" 
              variant="border" 
              size="small"
              alternative-text="Copy">
            </lightning-button-icon>
            <lightning-button-icon 
              icon-name="utility:paste" 
              variant="border" 
              size="small"
              alternative-text="Paste">
            </lightning-button-icon>
          </lightning-button-group>
        </div>
        
        <!-- Middle Controls -->
        <div class="slds-builder-toolbar__item-group slds-builder-toolbar__item-group_middle">
          <lightning-combobox 
            name="desktop" 
            label="" 
            value="Desktop" 
            placeholder="Desktop"
            options={desktopOptions}
            variant="label-hidden"
            class="slds-builder-toolbar__combobox"
            onchange={handleDesktopChange}>
          </lightning-combobox>
          
          <lightning-combobox 
            name="view" 
            label="" 
            value="Shrink To View" 
            placeholder="Shrink To View"
            options={viewOptions}
            variant="label-hidden"
            class="slds-builder-toolbar__combobox slds-builder-toolbar__combobox_small"
            onchange={handleViewChange}>
          </lightning-combobox>
        </div>
        
        <!-- Right Actions -->
        <div class="slds-builder-toolbar__actions">
          <lightning-button 
            label="Analyze" 
            variant="neutral" 
            onclick={handleAnalyze}>
          </lightning-button>
          <lightning-button 
            label="Activation..." 
            variant="neutral" 
            onclick={handleActivation}>
          </lightning-button>
          <lightning-button 
            label="Save" 
            variant="brand" 
            onclick={handleSave}>
          </lightning-button>
        </div>
      </div>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-container">
      <div class="canvas-content">
        <!-- Top Region -->
        <div class="drop-zone drop-zone-top">
          <div class="drop-zone-content">
            <div class="add-component-pill">
              <span class="add-component-text">Add component(s) Here</span>
            </div>
          </div>
        </div>

        <!-- Bottom Left Region with Selected Component -->
        <div class="drop-zone drop-zone-bottom-left selected-zone">
          <!-- Contact Card Component -->
          <div class="contact-card">
            <div class="contact-card-content">
              <!-- Header with Avatar and Info -->
              <div class="slds-media contact-header">
                <div class="slds-media__figure">
                  <lightning-avatar 
                    fallback-icon-name="standard:user" 
                    size="large" 
                    class="contact-avatar">
                  </lightning-avatar>
                </div>
                <div class="slds-media__body contact-info-body">
                  <h3 class="contact-name">Full Name</h3>
                  <p class="contact-location">City, State</p>
                </div>
              </div>
              
              <!-- Additional Fields from Profile Configuration - Above separator -->
              <template for:each={profileConfig.additionalFields} for:item="field">
                <div key={field.id} class="slds-media contact-detail-item additional-field-item">
                  <div class="slds-media__figure">
                    <lightning-icon 
                      icon-name={field.icon} 
                      size="x-small" 
                      class="contact-detail-icon">
                    </lightning-icon>
                  </div>
                  <div class="slds-media__body contact-detail-body">
                    <div class="contact-detail-label">{field.displayLabel}</div>
                    <div class="contact-detail-value">{field.displayLabel}</div>
                  </div>
                </div>
              </template>
              
              <!-- Separator -->
              <hr class="contact-separator">
              
              <!-- Contact Details -->
              <div class="contact-details-section">
                <div class="slds-media contact-detail-item">
                  <div class="slds-media__figure">
                    <lightning-icon 
                      icon-name="utility:email" 
                      size="x-small" 
                      class="contact-detail-icon">
                    </lightning-icon>
                  </div>
                  <div class="slds-media__body contact-detail-body">
                    <div class="contact-detail-label">Email (3 more)</div>
                    <div class="contact-detail-value">Email@domain.com</div>
                  </div>
                </div>
                
                <div class="slds-media contact-detail-item phone-field-item">
                  <div class="slds-media__figure">
                    <lightning-icon 
                      icon-name="utility:call" 
                      size="x-small" 
                      class="contact-detail-icon">
                    </lightning-icon>
                  </div>
                  <div class="slds-media__body contact-detail-body">
                    <div class="contact-detail-label">Phone (2 more)</div>
                    <div class="contact-detail-value">1234567890</div>
                  </div>
                </div>
                
                <!-- Address Field - Conditionally Rendered -->
                <template if:true={contactConfig.basicFields.showAddress}>
                  <div class="slds-media contact-detail-item address-field-item">
                    <div class="slds-media__figure">
                      <lightning-icon 
                        icon-name="utility:home" 
                        size="x-small" 
                        class="contact-detail-icon">
                      </lightning-icon>
                    </div>
                    <div class="slds-media__body contact-detail-body">
                      <div class="contact-detail-label">Address</div>
                      <div class="contact-detail-value">Street, City, State, Zipcode</div>
                    </div>
                  </div>
                </template>
                
                <!-- Insight Fields Section -->
                <template if:true={hasInsightFields}>
                  <!-- Insight Separator -->
                  <hr class="insight-separator">
                  
                  <!-- Insight Fields -->
                  <template for:each={insightsConfig.additionalFields} for:item="field">
                    <div key={field.id} class="slds-media contact-detail-item insight-field-item">
                      <div class="slds-media__figure">
                        <lightning-icon 
                          icon-name={field.icon} 
                          size="x-small" 
                          class="contact-detail-icon">
                        </lightning-icon>
                      </div>
                      <div class="slds-media__body contact-detail-body">
                        <div class="contact-detail-label">{field.displayLabel}</div>
                        <div class="contact-detail-value">{field.displayLabel}</div>
                      </div>
                    </div>
                  </template>
                </template>
              </div>
            </div>
          </div>
          
          <!-- Selection Border and Handles -->
          <div class="selection-border"></div>
          <div class="resize-handle resize-handle-top">
            <div class="resize-handle-icon">+</div>
          </div>
          <div class="resize-handle resize-handle-bottom">
            <div class="resize-handle-icon">+</div>
          </div>
        </div>

        <!-- Bottom Right Region -->
        <div class="drop-zone drop-zone-bottom-right">
          <div class="drop-zone-content">
            <div class="add-component-pill">
              <span class="add-component-text">Add component(s) Here</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Component Panel - SAME AS PROTOTYPE 1 -->
    <div class="component-panel">
      <!-- Tabs -->
      <div class="panel-tabs">
        <lightning-tabset active-tab-value="components">
          <lightning-tab label="Components" value="components"></lightning-tab>
          <lightning-tab label="Fields" value="fields"></lightning-tab>
        </lightning-tabset>
      </div>
      
      <!-- Search -->
      <div class="panel-search">
        <lightning-input 
          type="search" 
          label="Search"
          placeholder="Search..." 
          class="search-input"
          variant="label-hidden"
          onchange={handleSearch}>
        </lightning-input>
        <lightning-button-icon 
          icon-name="utility:settings" 
          variant="border" 
          class="settings-button">
        </lightning-button-icon>
      </div>
      
      <!-- Accordion -->
      <div class="panel-accordion">
        <lightning-accordion>
          <lightning-accordion-section name="standard" label="Standard (67)">
            <!-- Component List -->
            <div class="component-list">
              <template for:each={componentItems} for:item="item">
                <div key={item.id} class="list-item">
                  <div class="item-icon">
                    <template if:false={item.customSvg}>
                      <lightning-icon 
                        icon-name={item.icon} 
                        size="small">
                      </lightning-icon>
                    </template>
                    <template if:true={item.customSvg}>
                      <img src={item.customSvg} alt={item.label} class="custom-svg-icon">
                    </template>
                  </div>
                  <span class="item-label">{item.label}</span>
                </div>
              </template>
            </div>
          </lightning-accordion-section>
        </lightning-accordion>
      </div>
      
      <!-- AppExchange Footer -->
      <div class="appexchange-footer">
        <span class="footer-text">Get more on the AppExchange</span>
      </div>
    </div>
    
    <!-- Right Properties Panel - PROTOTYPE 2 SPECIFIC -->
    <div class="properties-panel">
      <!-- Header with Breadcrumb -->
      <div class="properties-header">
          <div class="breadcrumb-container">
            <span class="breadcrumb-link">Page</span>
            <span class="breadcrumb-separator"> > </span>
            <span class="breadcrumb-current">Data Cloud Unified Profile</span>
          </div>
      </div>
      
      <!-- Body Content -->
      <div class="properties-body">
        <!-- Description Text -->
        <div class="properties-description">
          <p>This component displays unified profile data from Data Cloud. To use it, you must first set up the Data Cloud Related Lists in the Object Manager. 
            <a href="#" class="slds-text-link">Learn More</a>
          </p>
        </div>
        
          <!-- Instruction Text -->
          <div class="instruction-text slds-text-body_regular" style="color: #3e3e3c;">
            Select the Data Space and Unified Object to find your Data Cloud Related Lists.
          </div>
          
          <!-- Data Cloud Builder Selection -->
          <div class="properties-field" style="margin-bottom: 0;">
            <lightning-combobox
              name="dataCloudBuilder"
              label="Data Space"
              placeholder="Select a Data Space"
              options={dataSpaceOptions}
              value="default"
              required
              class="data-cloud-combobox">
            </lightning-combobox>
          </div>

          <!-- Unified Object Selection -->
          <div class="properties-field">
            <lightning-combobox
              name="unifiedObject"
              label="Unified Object"
              placeholder="Select a Unified Object"
              options={unifiedObjectOptions}
              value="unified-individual"
              required
              class="unified-object-combobox">
            </lightning-combobox>
          </div>
        
        <!-- Properties Accordion -->
        <lightning-accordion
          active-section-name={activeAccordionSection}
          onsectiontoggle={handleAccordionToggle}
          onclick={handleAccordionClick}>
          <!-- Customize Profile Section -->
          <lightning-accordion-section name="customizeProfileSection" label="Customize Profile Section">
            <div class="profile-section-content">
              <!-- Description Text -->
              <p class="profile-description">
                The data in this section is sourced from the selected unified object. 
                <a href="#" class="slds-text-link">Learn More</a>
              </p>
              
              <!-- Set as Visible Toggle -->
              <div class="slds-form-element set-visible-toggle-section">
                <div class="slds-form-element__control">
                  <div class="slds-checkbox_toggle slds-grid">
                    <span class="slds-form-element__label">Set as Visible</span>
                    <label class="slds-checkbox_toggle slds-grid">
                      <input type="checkbox" name="profileVisible" checked aria-describedby="toggle-description" />
                      <span id="toggle-description" class="slds-checkbox_faux_container" aria-live="assertive">
                        <span class="slds-checkbox_faux"></span>
                        <span class="slds-checkbox_on">Visible</span>
                        <span class="slds-checkbox_off">Invisible</span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- Basic Profile Fields -->
              <div class="slds-form-element basic-profile-fields-section">
                <fieldset class="slds-form-element">
                  <legend class="slds-form-element__legend slds-form-element__label profile-field-label">Basic Profile Fields</legend>
                  <div class="slds-form-element__control">
                    <lightning-checkbox-group 
                      name="basicProfileFields"
                      label=""
                      options={basicProfileFieldOptions}
                      value={selectedBasicFields}
                      variant="label-hidden">
                    </lightning-checkbox-group>
                  </div>
                </fieldset>
              </div>
              
              <!-- Additional Fields -->
              <div class="slds-form-element additional-fields-section">
                <div class="slds-form-element__label-container">
                  <div class="additional-fields-label-row">
                    <label class="slds-form-element__label profile-field-label">Additional Fields (Up to 5)</label>
                    <div class="info-icon-container">
                      <svg class="info-icon" viewBox="0 0 520 520">
                        <path d="M260 20a240 240 0 100 480 240 240 0 100-480zm0 121c17 0 30 13 30 30s-13 30-30 30-30-13-30-30 13-30 30-30zm50 210c0 5-4 9-10 9h-80c-5 0-10-3-10-9v-20c0-5 4-11 10-11 5 0 10-3 10-9v-40c0-5-4-11-10-11-5 0-10-3-10-9v-20c0-5 4-11 10-11h60c5 0 10 5 10 11v80c0 5 4 9 10 9 5 0 10 5 10 11z"/>
                      </svg>
                    </div>
                  </div>
                </div>
                
                <!-- Field Pills -->
                <div class="additional-fields-container additional-fields-pills-section">
                          <template for:each={additionalProfileFields} for:item="field">
                            <div key={field.id} class="field-pill-container" data-field-id={field.id}>
                      <div class="field-pill">
                        <div class="field-pill-drag-icon">
                          <svg class="drag-icon" viewBox="0 0 52 52">
                            <path d="M20 4c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 28c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 40c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z"/>
                          </svg>
                        </div>
                        <div class="field-pill-content" onclick={handleEditField} data-field-id={field.id}>
                          <div class="field-display-name">{field.displayName}</div>
                        </div>
                        <div class="field-pill-close-icon" onclick={handleRemoveField} data-field-id={field.id}>
                          <svg class="close-icon" viewBox="0 0 520 520">
                            <path d="M310 254l130-131c6-6 6-15 0-21l-20-21c-6-6-15-6-21 0L268 212a10 10 0 01-14 0L123 80c-6-6-15-6-21 0l-21 21c-6 6-6 15 0 21l131 131c4 4 4 10 0 14L80 399c-6 6-6 15 0 21l21 21c6 6 15 6 21 0l131-131a10 10 0 0114 0l131 131c6 6 15 6 21 0l21-21c6-6 6-15 0-21L310 268a10 10 0 010-14z"/>
                          </svg>
                        </div>
                      </div>
                    </div>
                  </template>
                  
                  <!-- Add Field Button -->
                  <button class="slds-button slds-button_neutral add-field-button slds-m-top_x-small" type="button" onclick={handleAddProfileField} disabled={isAddFieldButtonDisabled}>
                    <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true" viewBox="0 0 520 520">
                      <path d="M300 290h165c8 0 15-7 15-15v-30c0-8-7-15-15-15H300c-6 0-10-4-10-10V55c0-8-7-15-15-15h-30c-8 0-15 7-15 15v165c0 6-4 10-10 10H55c-8 0-15 7-15 15v30c0 8 7 15 15 15h165c6 0 10 4 10 10v165c0 8 7 15 15 15h30c8 0 15-7 15-15V300c0-6 4-10 10-10z"/>
                    </svg>
                    Add Field
                  </button>
                  
                </div>
              </div>
            </div>
          </lightning-accordion-section>
          
          <!-- Customize Contact Section -->
          <lightning-accordion-section name="customizeContactSection" label="Customize Contact Section">
            <div class="contact-section-content">
              <!-- Description Text -->
              <p class="contact-description">
                The data in this section is sourced from the contact point objects. <a href="#" class="slds-text-link">Learn More</a>
              </p>
              
              <!-- Set as Visible Toggle -->
              <div class="slds-form-element set-visible-toggle-section">
                <div class="slds-form-element__control">
                  <div class="slds-checkbox_toggle slds-grid">
                    <span class="slds-form-element__label">Set as Visible</span>
                    <label class="slds-checkbox_toggle slds-grid">
                      <input type="checkbox" name="contactVisible" checked aria-describedby="contact-toggle-description" />
                      <span id="contact-toggle-description" class="slds-checkbox_faux_container" aria-live="assertive">
                        <span class="slds-checkbox_faux"></span>
                        <span class="slds-checkbox_on">Visible</span>
                        <span class="slds-checkbox_off">Invisible</span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- Basic Contact Fields -->
              <div class="slds-form-element basic-contact-fields-section">
                <fieldset class="slds-form-element">
                  <legend class="slds-form-element__legend slds-form-element__label profile-field-label">Basic Contact Fields</legend>
                  <div class="slds-form-element__control">
                    <lightning-checkbox-group 
                      name="basicContactFields"
                      label=""
                      options={basicContactFieldOptions}
                      value={selectedBasicContactFields}
                      variant="label-hidden"
                      onchange={handleBasicContactFieldChange}>
                    </lightning-checkbox-group>
                  </div>
                </fieldset>
              </div>
            </div>
          </lightning-accordion-section>
          
          <!-- Customize Insight Section -->
          <lightning-accordion-section name="customizeInsightSection" label="Customize Insight Section">
            <div class="insight-section-content">
              <!-- Description Text -->
              <p class="insight-description">
                The data in this section is sourced from the calculated insights objects and Data Cloud Copy Fields. 
                <a href="#" class="slds-text-link">Learn More</a>
              </p>
              
              <!-- Set as Visible Toggle -->
              <div class="slds-form-element set-visible-toggle-section">
                <div class="slds-form-element__control">
                  <div class="slds-checkbox_toggle slds-grid">
                    <span class="slds-form-element__label">Set as Visible</span>
                    <label class="slds-checkbox_toggle slds-grid">
                      <input type="checkbox" name="insightVisible" checked aria-describedby="insight-toggle-description" />
                      <span id="insight-toggle-description" class="slds-checkbox_faux_container" aria-live="assertive">
                        <span class="slds-checkbox_faux"></span>
                        <span class="slds-checkbox_on">Visible</span>
                        <span class="slds-checkbox_off">Invisible</span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- Insight Fields -->
              <div class="slds-form-element additional-fields-section">
                <div class="slds-form-element__label-container">
                  <div class="additional-fields-label-row">
                    <label class="slds-form-element__label profile-field-label">Insight Fields (Up to 5)</label>
                    <div class="info-icon-container">
                      <svg class="info-icon" viewBox="0 0 520 520">
                        <path d="M260 20a240 240 0 100 480 240 240 0 100-480zm0 121c17 0 30 13 30 30s-13 30-30 30-30-13-30-30 13-30 30-30zm50 210c0 5-4 9-10 9h-80c-5 0-10-3-10-9v-20c0-5 4-11 10-11 5 0 10-3 10-9v-40c0-5-4-11-10-11-5 0-10-3-10-9v-20c0-5 4-11 10-11h60c5 0 10 5 10 11v80c0 5 4 9 10 9 5 0 10 5 10 11z"/>
                      </svg>
                    </div>
                  </div>
                </div>
                
                <!-- Field Pills -->
                <div class="additional-fields-container additional-fields-pills-section">
                          <template for:each={additionalInsightFields} for:item="field">
                            <div key={field.id} class="field-pill-container" data-field-id={field.id}>
                      <div class="field-pill">
                        <div class="field-pill-drag-icon">
                          <svg class="drag-icon" viewBox="0 0 52 52">
                            <path d="M20 4c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 28c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM20 40c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm12 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z"/>
                          </svg>
                        </div>
                        <div class="field-pill-content" onclick={handleEditInsightField} data-field-id={field.id}>
                          <div class="field-display-name">{field.displayName}</div>
                        </div>
                        <div class="field-pill-close-icon" onclick={handleRemoveInsightField} data-field-id={field.id}>
                          <svg class="close-icon" viewBox="0 0 520 520">
                            <path d="M310 254l130-131c6-6 6-15 0-21l-20-21c-6-6-15-6-21 0L268 212a10 10 0 01-14 0L123 80c-6-6-15-6-21 0l-21 21c-6 6-6 15 0 21l131 131c4 4 4 10 0 14L80 399c-6 6-6 15 0 21l21 21c6 6 15 6 21 0l131-131a10 10 0 0114 0l131 131c6 6 15 6 21 0l21-21c6-6 6-15 0-21L310 268a10 10 0 010-14z"/>
                          </svg>
                        </div>
                      </div>
                    </div>
                  </template>
                  
                  <!-- Add Field Button -->
                  <button class="slds-button slds-button_neutral add-field-button slds-m-top_x-small" type="button" onclick={handleAddInsightField} disabled={isAddInsightFieldButtonDisabled}>
                    <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true" viewBox="0 0 520 520">
                      <path d="M300 290h165c8 0 15-7 15-15v-30c0-8-7-15-15-15H300c-6 0-10-4-10-10V55c0-8-7-15-15-15h-30c-8 0-15 7-15 15v165c0 6-4 10-10 10H55c-8 0-15 7-15 15v30c0 8 7 15 15 15h165c6 0 10 4 10 10v165c0 8 7 15 15 15h30c8 0 15-7 15-15V300c0-6 4-10 10-10z"/>
                    </svg>
                    Add Field
                  </button>
                  
                </div>
              </div>
            </div>
          </lightning-accordion-section>
          
          <!-- Customize Custom Section -->
          <lightning-accordion-section name="customizeCustomSection" label="Customize Custom Section">
            <div class="section-content">
              <p class="section-description">This section is not part of this test. Please ignore it.</p>
            </div>
          </lightning-accordion-section>
          
          <!-- Set Theme Details -->
          <lightning-accordion-section name="themeDetails" label="Set Theme Details">
            <div class="theme-content">
             <!-- Background Color Picker -->
             <div class="color-picker-field">
               <label>Background Color</label>
               <div class="color-picker-container">
                 <div class="color-picker-swatch">
                   <div class="color-swatch" style="background-color: #1591C3;"></div>
                   <lightning-icon icon-name="utility:down" size="x-small"></lightning-icon>
                 </div>
                 <lightning-input
                   type="text"
                   label="Color"
                   value="#1591C3"
                   variant="label-hidden"
                   class="color-input">
                 </lightning-input>
               </div>
             </div>
            </div>
          </lightning-accordion-section>
          
          <!-- Set Component Visibility Accordion -->
          <lightning-accordion-section name="componentVisibility" label="Set Component Visibility">
            <div class="visibility-content">
              <div class="filter-section">
                <label>Filter</label>
                <lightning-button
                  label="Add Filter"
                  icon-name="utility:add"
                  variant="neutral"
                  class="add-filter-button">
                </lightning-button>
              </div>
            </div>
          </lightning-accordion-section>
        </lightning-accordion>
      </div>
      
      <!-- Field Configuration Popover -->
      <template if:true={showFieldConfigPopover}>
        <section class={popoverClasses} style={popoverStyle} role="dialog">
          <button class="slds-button slds-button_icon slds-button_icon-x-small slds-float_right slds-popover__close" onclick={handleConfigClose} title="Close dialog">
            <lightning-icon icon-name="utility:close" alternative-text="Close dialog" size="x-small"></lightning-icon>
            <span class="slds-assistive-text">Close dialog</span>
          </button>
          <div class="slds-popover__body" id="popover-body">
            <div class="slds-form">
              <!-- Calculated Insight Name (only for Insight fields) -->
              <template if:true={editingFieldId}>
                <template if:true={isInsightField}>
                  <lightning-combobox
                    label="Calculated Insight Name"
                    name="configCalculatedInsightName"
                    value={configCalculatedInsightName}
                    placeholder="Select calculated insight"
                    options={calculatedInsightNameOptions}
                    onchange={handleCalculatedInsightNameChange}
                    class="popover-field">
                  </lightning-combobox>
                </template>
              </template>

              <!-- Metric Name / Field Name -->
              <lightning-combobox
                label={fieldNameLabel}
                name="configFieldName"
                value={configFieldName}
                placeholder={fieldNamePlaceholder}
                options={fieldNameOptionsToUse}
                onchange={handleFieldNameConfigChange}
                class="popover-field">
              </lightning-combobox>

              <!-- Display Label -->
              <lightning-input
                label="Display Label"
                name="configDisplayLabel"
                value={configDisplayLabel}
                onchange={handleDisplayLabelConfigChange}
                class="popover-field">
              </lightning-input>

              <!-- Icon -->
              <lightning-combobox
                label="Icon"
                name="configIcon"
                value={configIcon}
                placeholder="Select an icon"
                options={currentIconOptions}
                onchange={handleIconConfigChange}
                class="popover-field">
              </lightning-combobox>

              <!-- Done Button -->
              <div class="slds-text-align_right">
                <lightning-button
                  label="Done"
                  variant="neutral"
                  disabled={isDoneButtonDisabled}
                  onclick={handleConfigDone}>
                </lightning-button>
              </div>
            </div>
          </div>
        </section>
      </template>
    </div>
  </div>

  <!-- Profile Modal -->
  <main-profile-modal 
    is-open={showProfileModal}
    onmodalclose={handleProfileModalClose}
    onsave={handleProfileSave}>
  </main-profile-modal>

  <!-- Contact Modal -->
  <main-contact-modal 
    is-open={showContactModal}
    onmodalclose={handleContactModalClose}
    onsave={handleContactSave}>
  </main-contact-modal>

  <!-- Add Section Modal (Step 1) -->
  <main-add-section-modal 
    is-open={showAddSectionModal}
    onmodalclose={handleAddSectionModalClose}
    onaddsection={handleAddSection}>
  </main-add-section-modal>

  <!-- Add Insight Modal (Step 2) -->
  <main-add-insight-modal 
    is-open={showAddInsightModal}
    onmodalclose={handleAddInsightModalClose}
    onback={handleAddInsightBack}
    onsave={handleAddInsightSave}>
  </main-add-insight-modal>

</template>
